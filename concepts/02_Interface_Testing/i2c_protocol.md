# I²C (Inter-Integrated Circuit) Protocol

## 1. Purpose & Common Uses

* **Goal:** Designed for simple, bi-directional, two-wire communication between different integrated circuits (chips) on the **same printed circuit board (PCB)** over short distances.
* **Invented By:** Philips Semiconductor (now NXP).
* **Common Uses:**
    * Microcontrollers communicating with sensors (temperature, pressure, accelerometers).
    * Accessing EEPROM memory chips (for storing configuration data).
    * Interfacing with real-time clocks (RTCs).
    * Controlling I/O expander chips (to get more input/output pins).
    * Configuring and controlling power management ICs (PMICs), audio codecs, etc.

## 2. Key Characteristics

* **Synchronous:** Uses a shared clock signal (`SCL`) generated by the master to time data transfers.
* **Serial:** Data is transferred one bit at a time over the data line (`SDA`).
* **Two Wires (Mainly):** Requires only `SCL` and `SDA` signal lines (plus common power/ground connections).
* **Multi-Master / Multi-Slave:** Allows multiple devices capable of initiating transfers (masters) and multiple devices that respond (slaves) on the same bus. (Note: Single-master configurations are most common).
* **Addressed:** Each slave device must have a unique address on the bus so the master can select which one to communicate with.

## 3. The Signal Lines

* **`SCL` (Serial Clock):**
    * Clock signal driven *by the master* device.
    * Determines the timing for shifting data bits on/off the `SDA` line.
* **`SDA` (Serial Data):**
    * The bi-directional data line used to transfer addresses, control information, and actual data between devices.
* **Pull-Up Resistors (Essential!):**
    * Both `SCL` and `SDA` lines *require* external pull-up resistors connected to the positive supply voltage (e.g., VCC, VDD, +3.3V, +5V). Typical values range from 1kΩ to 10kΩ.
    * **Reason:** I2C devices typically use open-drain/open-collector outputs. They can actively pull the line LOW (logic '0') but cannot actively drive it HIGH (logic '1'). When inactive or sending a '1', they release the line, and the resistor pulls it up to the HIGH state.
    * **Benefits:** Establishes the default IDLE state (HIGH), prevents bus contention (short circuits if multiple devices try to drive HIGH/LOW simultaneously), allows multiple devices to share the lines safely.

## 4. Fundamental Rules & Bus States

* **IDLE State:** Both `SDA` and `SCL` are HIGH.
* **START Condition (S):** Initiated by the master. `SDA` transitions from HIGH to LOW *while* `SCL` is HIGH. This signals the beginning of a transmission to all devices.
* **STOP Condition (P):** Initiated by the master. `SDA` transitions from LOW to HIGH *while* `SCL` is HIGH. This signals the end of a transmission.
* **Data Transfer Rule:**
    * Data bits are transferred one per `SCL` clock pulse.
    * The data level on `SDA` **must remain stable** whenever `SCL` is HIGH.
    * Changes in the `SDA` level (to set up the next bit) must occur only when `SCL` is LOW.
    * Data is typically transferred MSB (Most Significant Bit) first.

## 5. Basic Transaction Flow

### Master Write Transaction

1.  **Master:** Initiates START (S).
2.  **Master:** Sends 7-bit Slave Address + R/W bit set to **0** (Write).
3.  **Slave:** If address matches, responds with ACK (pulls `SDA` LOW for the 9th clock pulse).
4.  **Master:** Sends Data Byte(s) (e.g., internal register address, data value).
5.  **Slave:** Sends ACK after each successfully received data byte.
6.  **Master:** Initiates STOP (P) when done writing.

### Master Read Transaction

1.  **Master:** Initiates START (S).
2.  **Master:** Sends 7-bit Slave Address + R/W bit set to **1** (Read).
3.  **Slave:** If address matches, responds with ACK.
4.  **Slave:** Sends Data Byte(s) back to the master.
5.  **Master:** Sends ACK after each received byte *except* the last one.
6.  **Master:** Sends NACK (leaves `SDA` HIGH) after the final desired byte to signal the slave to stop sending.
7.  **Master:** Initiates STOP (P).

## 6. Key Concepts Recap

* **Addressing:** Typically 7-bit addresses are used (allowing up to 112 usable addresses, as some are reserved). 10-bit addressing exists but is less common. Every slave on a single bus must have a unique address.
* **ACK/NACK (Acknowledge/Not Acknowledge):** The essential handshake. The receiver pulls `SDA` low after each byte to signal successful reception (ACK). If `SDA` remains high, it's a NACK, indicating an issue (e.g., wrong address, device busy, receiver doesn't want more data).
* **Clock Stretching (Optional Feature):** A slave device can hold the `SCL` line LOW temporarily to force the master to pause transmission, typically if the slave needs more time to process data or prepare its response.

## 7. Pros and Cons

* **Pros:**
    * Minimal wiring (only 2 signal lines).
    * Supports multiple slave devices (and potentially multiple masters).
    * Well-established, widely adopted standard.
    * Includes ACK/NACK for basic error detection/flow control.
* **Cons:**
    * Slower speeds compared to protocols like SPI (Standard: 100kbps, Fast: 400kbps, Fast Mode+: 1Mbps, High Speed: 3.4Mbps).
    * Requires pull-up resistors.
    * Protocol overhead (START, STOP, Address, R/W bit, ACK/NACK bits).
    * Can be susceptible to noise causing spurious START/STOP conditions.
    * Multi-master arbitration can add complexity.

## 8. Relevance to Testing & Debug

Understanding I2C is critical for:

* **Debugging Communication:** Using logic analyzers or oscilloscopes to monitor `SDA` and `SCL` to diagnose failures (e.g., missing ACKs, incorrect addresses, timing issues).
* **Device Configuration:** Many tests require configuring devices (PMICs, sensors, clock chips) via I2C before the main test can run.
* **Functional Verification:** Writing commands and reading status or data via I2C as part of a board's functional test sequence.
* **Interfacing with Test Fixtures:** Some test jigs or fixtures might use I2C internally.
